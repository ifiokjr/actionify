# actionify

> Create TypeSafe GitHub actions.

## Why?

Continuous integration (CI) is an essential safety net for any sustainable open source project. GitHub Actions have become the industry standard. Unfortunately they use `.yml` files which are error prone and make reuse difficult.

I decided to create this project after implement a rust build pipeline for a `rust` / `napi` project which builds across multiple platforms. The `.yml` files were getting very long and hard to maintain. By using this tool I've been able to reduce the complexity massively and allow for much simpler reuse of code.

## Usage

This project requires a recent [installation](https://deno.land/manual@v1.25.2/getting_started/installation) of `deno` and is tested to run on versions greater than `1.24.x`. It may work on older versions but this is not guaranteed.

The following setup uses the defaults. These can be customised as documented later in this readme.

The first thing to do is create the file `.github/actionify.ts` file which will contain the configuration for creating all workflow actions. The example will be taken from the GitHub [quickstart guide](https://docs.github.com/en/actions/quickstart#creating-your-first-workflow).

```ts
import {
  defineWorkflows,
  e,
  step,
  workflow,
} from "https://deno.land/x/actionify@0.0.0/mod.ts";

// Create the configuration for the CI workflow.
const ciWorkflow = workflow({ name: "GitHub Actions Demo", fileName: "ci" })
  .on("push")
  // Set the job and it's ID. The ID can be used to access the job context later.
  .job("Explore-GitHub-Actions", (job) => {
    return job.steps(generateSteps());
  });

// Create the configuration for the CI workflows. When the CLI is run this will be
// used to create the workflows.
export default defineWorkflows({
  workflows: [ciWorkflow],
});

// Create steps which will be used in the job.
function generateSteps() {
  return [
    step().run(
      `echo "🎉 The job was automatically triggered by a ${
        e.wrap(e.ctx.github.event_name)
      } event.`,
    ),
    step().run(
      `echo "🐧 This job is now running on a ${
        e.wrap(e.ctx.runner.os)
      } server hosted by GitHub!"`,
    ),
    step().run(
      `echo "🔎 The name of your branch is ${
        e.wrap(e.ctx.github.ref)
      } and your repository is ${e.wrap(e.ctx.github.repository)}."`,
    ),
    step().name("Check out the repository code").uses("actions/checkout@v3"),
    step().run(
      `echo "💡 The ${
        e.wrap(e.ctx.github.repository)
      } repository has been cloned to the runner."`,
    ),
    step().run(
      'echo "🖥️ The workflow is now ready to test your code on the runner."',
    ),
    step().name("List files in your repository").run([
      `ls ${e.wrap(e.ctx.github.workspace)}`,
    ]),
    step().run((ctx) => {
      return `echo "🍏 This job's status is ${e.wrap(ctx.job.status)}."`;
    }),
  ];
}
```

The above example will generate the following workflow file:

```yml
# This file was autogenerated with actionify@0.0.0
# To update run:
# deno run -Ar https://deno.land/x/actionify/cli.ts

name: GitHub Actions Demo
'on':
  push: null
jobs:
  Explore-GitHub-Actions:
    steps:
      - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event.
      - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: >-
          echo "🔎 The name of your branch is ${{ github.ref }} and your repository is ${{
          github.repository }}."
      - name: Check out the repository code
        uses: actions/checkout@v3
      - run: echo "💡 The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "🖥️ The workflow is now ready to test your code on the runner."
      - name: List files in your repository
        run: ls ${{ github.workspace }}
      - run: echo "🍏 This job's status is ${{ job.status }}."
```

## Contributing

To contribute first update your cache with

```bash
deno task lock
```

This both generates the lockfile and makes sure the same cache is used for all contributors.

To check that all you code is working as expected, run:

```bash
deno task check
```

This will test, lint and check that formatting is correct.

_created with [`scaffold`](https://github.com/ifiokjr/scaffold)_
